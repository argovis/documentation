

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Prometheus metrics for Argovis &mdash; argovis  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Appendix: Archival Notes" href="../special_topics/intro.html" />
    <link rel="prev" title="Openshift SSL Certificate Management" href="openshift-ssl.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> argovis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">0. Welcome</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Argovis Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#argovis-engineering-at-a-glance">Argovis engineering at a glance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#documentation-conventions">Documentation conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contributing">Contributing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#table-of-contents">Table of contents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../database/getting_started.html">Getting started with Argovis’ data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/schema.html">Argovis data schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/db_ops.html">Database Resourcing &amp; Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/adding_new_data.html">Adding a new dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/argo.html">Managing Argo Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/getting_started.html">Getting started with Argovis API development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/qsp.html">API Query String Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/adding_new_endpoints.html">Adding new API routes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/rate_limitation.html">API rate limitation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/ops_config.html">API deployment configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/hit_logging.html">API hit logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="deployment.html">Argovis Deployment Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="drifters-aws.html">Deploy Global Drifter Program database on AWS</a></li>
<li class="toctree-l3"><a class="reference internal" href="openshift-ssl.html">Openshift SSL Certificate Management</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Prometheus metrics for Argovis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#raw-metrics">Raw metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deployment-notes">Deployment notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#useful-promql-queries">Useful PromQL queries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/intro.html">Appendix: Archival Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/pull_requests_and_github.html">Pull Requests, Git &amp; GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/merge_conflicts.html">Dealing With Merge Conflicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/using_branches.html">Using Branches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/connecting_to_the_container_network.html">Connecting to the Container Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/goship-demo.html">Goship Demo Rebuild</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/api_usage.html">Argovis API Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special_topics/performance_testing.html">Performance Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">1. Data &amp; Database</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../database/getting_started.html">Getting started with Argovis’ data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database/schema.html">Argovis data schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database/db_ops.html">Database Resourcing &amp; Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database/adding_new_data.html">Adding a new dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../database/argo.html">Managing Argo Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">2. API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/getting_started.html">Getting started with Argovis API development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/qsp.html">API Query String Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/adding_new_endpoints.html">Adding new API routes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/rate_limitation.html">API rate limitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/ops_config.html">API deployment configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/hit_logging.html">API hit logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">4. Deployment &amp; operations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Argovis Deployment Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="drifters-aws.html">Deploy Global Drifter Program database on AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="openshift-ssl.html">Openshift SSL Certificate Management</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Prometheus metrics for Argovis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#raw-metrics">Raw metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-notes">Deployment notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useful-promql-queries">Useful PromQL queries</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix: Archival Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/intro.html">Appendix: Archival Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/pull_requests_and_github.html">Pull Requests, Git &amp; GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/merge_conflicts.html">Dealing With Merge Conflicts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/using_branches.html">Using Branches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/connecting_to_the_container_network.html">Connecting to the Container Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/goship-demo.html">Goship Demo Rebuild</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/api_usage.html">Argovis API Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/performance_testing.html">Performance Testing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">argovis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Prometheus metrics for Argovis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/ops/prometheus.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="prometheus-metrics-for-argovis">
<span id="prometheus"></span><h1>Prometheus metrics for Argovis<a class="headerlink" href="#prometheus-metrics-for-argovis" title="Permalink to this headline">¶</a></h1>
<p>Argovis’ API is instrumented with several Prometheus metrics to help monitor its performance. These metrics are exposed on the <cite>/metrics</cite> endpoint of the API, and can be scraped by a Prometheus server for monitoring.</p>
<div class="section" id="raw-metrics">
<h2>Raw metrics<a class="headerlink" href="#raw-metrics" title="Permalink to this headline">¶</a></h2>
<p>The following Prometheus counters track the lifecycle of an incoming request:</p>
<blockquote>
<div><ul class="simple">
<li><p>incoming_requests: A counter of the number of requests the API has received at the top of the token bucket.</p></li>
<li><p>requests_denied: Number of incoming HTTP requests rejected due to malformed input (400), ginormous temporospatial extent (413), or throttling (429)</p></li>
<li><p>requests_error: crash encountered in lookup or transmission (500 series)</p></li>
<li><p>successful_requests: made it to the end of the pipeline, ready to be returned</p></li>
</ul>
</div></blockquote>
<p>We also have one histogram, <cite>api_request_duration_seconds</cite>, that tracks the duration of requests in seconds.</p>
</div>
<div class="section" id="deployment-notes">
<h2>Deployment notes<a class="headerlink" href="#deployment-notes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>All the kubernetes infrastructure needed for this is described in the helm charts and will deploy with the rest of the stack.</p></li>
<li><p>Note it is important to use the role and roleBindings provided so Prometheus can automatically track all API pods, as opposed to getting random pod responses from the service routing to them.</p></li>
<li><p>The blackbox deployment is solely responsible for tracking API uptime.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="useful-promql-queries">
<h2>Useful PromQL queries<a class="headerlink" href="#useful-promql-queries" title="Permalink to this headline">¶</a></h2>
<p>Prometheus uses its own simple query language fo visualizing things at its frontend, which you can find at <a class="reference external" href="https://argovis-prom-atoc-argovis-dev.apps.containers02.colorado.edu/">https://argovis-prom-atoc-argovis-dev.apps.containers02.colorado.edu/</a> behind the CU VPN. Here are some common interesting queries:</p>
<ul class="simple">
<li><p><cite>sum(incoming_requests{endpoint!=’/ping’}) by (endpoint)</cite>: [<a class="reference external" href="https://argovis-prom-atoc-argovis-dev.apps.containers02.colorado.edu/graph?g0.expr=sum(incoming_requests%7Bendpoint!%3D%27%2Fping%27%7D)%20by%20(endpoint)&amp;g0.tab=0&amp;g0.display_mode=lines&amp;g0.show_exemplars=0&amp;g0.range_input=1h">link</a>] show the cumulative number of requests to each endpoint</p>
<ul>
<li><p>sum is needed to sum over backend API containers</p></li>
<li><p>we exclude ping because those run every few seconds as a health check</p></li>
<li><p>note these counters will reset when pods roll over.</p></li>
</ul>
</li>
<li><p><cite>probe_success{job=’api-uptime’, instance=’https://argovis-api.colorado.edu/ping’}</cite>: [<a class="reference external" href="https://argovis-prom-atoc-argovis-dev.apps.containers02.colorado.edu/graph?g0.expr=probe_success{job%3D'api-uptime'%2Cinstance%3D'https%3A%2F%2Fargovis-api.colorado.edu%2Fping'}&amp;g0.tab=0&amp;g0.display_mode=lines&amp;g0.show_exemplars=0&amp;g0.range_input=4w">link</a>] see uptime for API</p></li>
<li><p><cite>histogram_quantile(0.50, sum(rate(api_request_duration_seconds_bucket{endpoint=”/argo”}[6h])) by (le))</cite>: [<a class="reference external" href="https://argovis-prom-atoc-argovis-dev.apps.containers02.colorado.edu/graph?g0.expr=histogram_quantile(0.50%2C%20sum(rate(api_request_duration_seconds_bucket%7Bendpoint%3D%22%2Fargo%22%7D%5B6h%5D))%20by%20(le))&amp;g0.tab=0&amp;g0.display_mode=lines&amp;g0.show_exemplars=0&amp;g0.range_input=4w">link</a>] see median request time for the /argo endpoint over the last six hours.</p></li>
</ul>
<p><em>Last reviewed 2025-02-02</em></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../special_topics/intro.html" class="btn btn-neutral float-right" title="Appendix: Archival Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="openshift-ssl.html" class="btn btn-neutral float-left" title="Openshift SSL Certificate Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2024, Argovis Collaboration.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>