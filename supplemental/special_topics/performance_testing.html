

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Performance Testing &mdash; argovis  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> argovis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../database/schema.html">Argovis data schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/qsp.html">API Query String Parameters</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">argovis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Performance Testing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/special_topics/performance_testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="performance-testing">
<span id="perftest"></span><h1>Performance Testing<a class="headerlink" href="#performance-testing" title="Permalink to this headline">¶</a></h1>
<p>In order to ensure Argovis scales to as many users as possible, and to give those users as good an experience as possible, Argovis undergoes performance testing to identify bottlenecks and measure viable load. This tutorial gives a high level overview of the tools and techniques available; refer to linked repos and docs for deeper dives.</p>
<div class="section" id="load-testing">
<h2>Load Testing<a class="headerlink" href="#load-testing" title="Permalink to this headline">¶</a></h2>
<p>Load testing scripts and resources are maintained in <a class="reference external" href="https://github.com/argovis/artillery">this repo</a>, and serve as our primary performance metric. As noted there, a key metric to track is median response time over time - this should be as stable as possible even for the heaviest endpoints, or else sustained load could degrade and crash the app. See the README in that repo for detailed config and run instructions.</p>
</div>
<div class="section" id="database-response-testing">
<h2>Database Response Testing<a class="headerlink" href="#database-response-testing" title="Permalink to this headline">¶</a></h2>
<p>In order to determine if mongodb is primarily responsible for slow responses from the API, we can use its built in profiler per the following. See <a class="reference external" href="https://docs.mongodb.com/manual/tutorial/manage-the-database-profiler/">the mongo docs</a> for more info.</p>
<ol class="arabic">
<li><p>Connect to a <code class="docutils literal notranslate"><span class="pre">mongo</span></code> shell in your running mongo container, using <code class="docutils literal notranslate"><span class="pre">oc</span> <span class="pre">exec</span></code>, <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">container</span> <span class="pre">exec</span></code>, or <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">exec</span></code> as appropriate for your environment.</p></li>
<li><p>Turn on mongo’s profiler. 100 ms is a reasonable cutoff for our purposes; actions slower than this will be logged:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; use argo
&gt; db.setProfilingLevel<span class="o">(</span><span class="m">1</span>, <span class="o">{</span> slowms: <span class="m">100</span> <span class="o">})</span>
</pre></div>
</div>
</li>
<li><p>Run some API requests, by hitting it manually or by running the Artillery scripts linked above.</p></li>
<li><p>Back in the mongo shell, check for events that took longer than 1000 ms (adjust to taste):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; db.system.profile.find<span class="o">(</span> <span class="o">{</span> millis : <span class="o">{</span> <span class="nv">$gt</span> : <span class="m">1000</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>.pretty<span class="o">()</span>
</pre></div>
</div>
<p>From here, you’ll have a list of the most expensive operations mongo is processing. See the <code class="docutils literal notranslate"><span class="pre">millis</span></code> key in the response documents for the length of time mongo spent on the operation; if this is a large or majority contribution to the response time of the API, consider scaling mongo or restricting the size of API calls allowed.</p>
</li>
<li><p>When done, make sure to turn off profiling in order to avoid impacting performance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; db.setProfilingLevel<span class="o">(</span><span class="m">0</span><span class="o">)</span>
</pre></div>
</div>
</li>
</ol>
<p><em>Last reviewed –</em></p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2024, Argovis Collaboration.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>